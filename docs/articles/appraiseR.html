<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>appraiseR • appraiseR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="appraiseR">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">appraiseR</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/appraiseR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lfpdroubi/REATOOLS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>appraiseR</h1>
                        <h4 class="author">Luiz Fernando Palin Droubi</h4>
            
            <h4 class="date">25/07/2018</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lfpdroubi/REATOOLS/blob/master/vignettes/appraiseR.Rmd"><code>vignettes/appraiseR.Rmd</code></a></small>
      <div class="hidden name"><code>appraiseR.Rmd</code></div>

    </div>

    
    
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p><code>appraiseR</code> comes with built-in <code>SpatialPointsDataFrames</code> such as <code>centro_2015</code>, <code>centro_13_15</code>, <code>itacorubi_2015</code>, <code>trivelloni_2005</code> and other <code>dataframes</code> like <code>loteamento</code>, <code>renda</code>, <code>canasvieiras_97</code>, <code>trindade_ap</code>, <code>terrenos_praia</code>, <code>trindade</code> and <code>jungles</code>.</p>
<p>More information on the available datasets can be find using the <code>help</code> command in <code>R</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">help</span>(centro_<span class="dv">2015</span>)</code></pre></div>
<p><strong>Prices of 50 Florianopolis’ downtown apartaments</strong></p>
<p><strong>Description</strong></p>
<p>A SpatialPointsDataFrame containing a sample of 50 apartaments with prices and other attributes in Florianopolis’ downtown</p>
<p><strong>Usage</strong></p>
<p><code>centro_2015</code></p>
<p><strong>Format</strong></p>
<p>A tibble with 53 rows (50 samples and 3 apartments to be appraised) and 7 variables:</p>
<ul>
<li>valor: price, in brazilian Reais</li>
<li>area_total: Total Area, in squared meters</li>
<li>quartos: Rooms</li>
<li>suites: Ensuites</li>
<li>garagens: Garages</li>
<li>dist_b_mar: Distance to the beach</li>
<li>padrao: Building Standard - baixo, medio, alto (i.e. low, normal, high)</li>
</ul>
<p><strong>Source</strong></p>
<p><strong>HOCHHEIM, Norberto</strong>. <em>Engenharia de avaliacoes imobiliarias: Modulo Basico</em>. Florianopolis: IBAPE/SC, 2015, p.21-22</p>
</div>
<div id="objective" class="section level2">
<h2 class="hasAnchor">
<a href="#objective" class="anchor"></a>Objective</h2>
<p>Real Estate Appraisals in Brazil are standardized in NBR 14.653-2. The standard recommended procedure is to build a multiple linear regression analysis. Transformation of the parameters to obtain a better fit is usual, although appraisers are not familiar with box-cox or other methods to find best transformations.</p>
<p>The main purpose of <code>appraiseR</code> is to help engineers to find transformations of the parameters in the model in order to obtain the best fit that satisfies the recomendations stablished in NBR 14.653-2.</p>
</div>
<div id="outlier-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#outlier-analysis" class="anchor"></a>Outlier analysis</h2>
<p>Outlier analysis by several criteria can be achieved trough the <code>outlier_analysis</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/outlier_analysis.html">outlier_analysis</a></span>(<span class="dt">x =</span> trindade, <span class="dt">criterion =</span> <span class="st">"30_percent"</span>)</code></pre></div>
<pre><code>## removing values</code></pre>
<pre><code>##  [1] 427 458 510 511 528 545 564 574 574 590 601 602 602 609 620</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/outlier_analysis.html">outlier_analysis</a></span>(<span class="dt">x =</span> trindade, <span class="dt">criterion =</span> <span class="st">"2_sd"</span>)</code></pre></div>
<pre><code>## Step 1: removing values 427</code></pre>
<pre><code>## Step 2: removing values 458</code></pre>
<pre><code>##  [1] 510 511 528 545 564 574 574 590 601 602 602 609 620</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/outlier_analysis.html">outlier_analysis</a></span>(<span class="dt">x =</span> trindade, <span class="dt">criterion =</span> <span class="st">"chauvenet"</span>)</code></pre></div>
<pre><code>## Step 1: removing values 427</code></pre>
<pre><code>## Step 2: removing values 458</code></pre>
<pre><code>##  [1] 510 511 528 545 564 574 574 590 601 602 602 609 620</code></pre>
</div>
<div id="running-bestfit" class="section level2">
<h2 class="hasAnchor">
<a href="#running-bestfit" class="anchor"></a>Running bestfit</h2>
<p><code>appraiseR</code> package includes both functions to help the appraiser to find best fits through the transformation of the parameters in the model (bestfit()) and functions to help the appraiser to verifie that the found fit satisfies the criteria of the brazilian standard NBR 14.653-2.</p>
<p>The first thing to be done is try to find the best model with bestfit function, as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(appraiseR)
data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(centro_<span class="dv">2015</span><span class="op">@</span>data)
best_fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bestfit.html">bestfit</a></span>(valor<span class="op">~</span>., data)</code></pre></div>
<p><code>bestfit</code> automatically fits a series of transformations in the parameteres and combine them in several models. These models are later ordered by the adjusted R<sup>2</sup> criteria. By default, <code>bestfit</code> uses three transformations functions, equivalent to the use of the box-cox method with <span class="math inline">\(-0.5 \leq \lambda \leq +0.5\)</span>. This can be changed with the <code>transf</code> argument.</p>
<p>If printed, a bestfit object shows a table of the best 10 models found according to the criteria mentioned above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(best_fit)</code></pre></div>
<pre><code>## Call:
## bestfit.formula(formula = valor ~ ., data = data)
## 
## Best 10 fits:
##     id valor area_total quartos   suites garagens dist_b_mar    adj_R2
## 443  1 rsqrt       sqrt   rsqrt identity     sqrt      rsqrt 0.9480455
## 395  2 rsqrt   identity   rsqrt identity     sqrt      rsqrt 0.9477222
## 955  3 rsqrt       sqrt   rsqrt     sqrt     sqrt      rsqrt 0.9474578
## 907  4 rsqrt   identity   rsqrt     sqrt     sqrt      rsqrt 0.9472744
## 439  5 rsqrt       sqrt     log identity     sqrt      rsqrt 0.9471142
## 951  6 rsqrt       sqrt     log     sqrt     sqrt      rsqrt 0.9468425
## 391  7 rsqrt   identity     log identity     sqrt      rsqrt 0.9466028
## 903  8 rsqrt   identity     log     sqrt     sqrt      rsqrt 0.9465023
## 411  9 rsqrt        log   rsqrt identity     sqrt      rsqrt 0.9460101
## 407 10 rsqrt        log     log identity     sqrt      rsqrt 0.9455580
## ...</code></pre>
<p>The number of printed lines may be changed in the print method, if desired:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(best_fit, <span class="dt">n =</span> <span class="dv">20</span>)</code></pre></div>
<p>The summary method is also available for bestfit objects. The user may find helpful not to use the first model in the table, so in the summary method is possible to choose the desired fit to be used with the fit argument, as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> </span><span class="kw">summary</span>(best_fit, <span class="dt">fit =</span> <span class="dv">1</span>)
s</code></pre></div>
<pre><code>## Call:
## bestfit.formula(formula = valor ~ ., data = data)
## 
## Best (Chosen) Transformations:
##     id valor area_total quartos   suites garagens dist_b_mar    adj_R2
## 443  1 rsqrt       sqrt   rsqrt identity     sqrt      rsqrt 0.9480455
## 
## Best (Chosen) fit LM summary:
## 
## Call:
## lm(formula = "rsqrt(valor) ~ sqrt(area_total) + rsqrt(quartos) + identity(suites) + sqrt(garagens) + rsqrt(dist_b_mar) + (padrao)", 
##     data = data, subset = NULL)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -2.144e-04 -5.344e-05  8.870e-07  4.272e-05  1.729e-04 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        1.780e-03  1.301e-04  13.681  &lt; 2e-16 ***
## sqrt(area_total)  -2.279e-05  5.295e-06  -4.304 9.81e-05 ***
## rsqrt(quartos)     6.561e-04  1.269e-04   5.169 6.14e-06 ***
## identity(suites)  -4.240e-05  2.060e-05  -2.058   0.0459 *  
## sqrt(garagens)    -2.711e-04  4.426e-05  -6.125 2.62e-07 ***
## rsqrt(dist_b_mar) -2.628e-03  5.099e-04  -5.154 6.45e-06 ***
## padraomedio       -2.214e-04  4.586e-05  -4.828 1.85e-05 ***
## padraoalto        -2.576e-04  4.605e-05  -5.595 1.52e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 8.428e-05 on 42 degrees of freedom
##   (3 observations deleted due to missingness)
## Multiple R-squared:  0.9555, Adjusted R-squared:  0.948 
## F-statistic: 128.7 on 7 and 42 DF,  p-value: &lt; 2.2e-16
## 
## NBR-14.653-2 check:
## Minimum number of market data:
## [1] "n = 53 &gt;= 42 --&gt; Grau III"
## Max significance level allowed for each predictor:
## [1] "t máximo = 4.59 %  &lt; 10% --&gt; Grau III"
## Max significance level allowed for F-test:
## [1] "p-valor F = 2.79e-24 % &lt; 1% --&gt; Grau III"</code></pre>
<p>One can note that the summary method performs a linear model with the chosen fit to give the user the possibility to verifie the main diagnostics data of the model.</p>
</div>
<div id="updating" class="section level2">
<h2 class="hasAnchor">
<a href="#updating" class="anchor"></a>Updating</h2>
<p>You can easily update your calls to <code>bestfit</code>. For this, a update method is made available specific for bestfit objects.</p>
<p>Despite the effort made to find the best transformations there is a possibility that some outliers still be present in the model. The user may search for them with very usual R functions, as <code>outlierTest</code> available in the <code>car</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">car<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/car/topics/outlierTest">outlierTest</a></span>(s<span class="op">$</span>fit)</code></pre></div>
<pre><code>## No Studentized residuals with Bonferonni p &lt; 0.05
## Largest |rstudent|:
##     rstudent unadjusted p-value Bonferonni p
## 31 -2.896612          0.0060262      0.30131</code></pre>
<p>With the results of the outlier test, one can update the <code>bestfit</code> call as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">best_fit &lt;-<span class="st"> </span><span class="kw">update</span>(best_fit, <span class="dt">subset =</span> <span class="op">-</span><span class="dv">31</span>)
<span class="kw">summary</span>(best_fit)</code></pre></div>
<pre><code>## Call:
## bestfit.formula(formula = valor ~ ., data = data, subset = -31)
## 
## Best (Chosen) Transformations:
##     id valor area_total quartos   suites garagens dist_b_mar    adj_R2
## 443  1 rsqrt       sqrt   rsqrt identity     sqrt      rsqrt 0.9566219
## 
## Best (Chosen) fit LM summary:
## 
## Call:
## lm(formula = "rsqrt(valor) ~ sqrt(area_total) + rsqrt(quartos) + identity(suites) + sqrt(garagens) + rsqrt(dist_b_mar) + (padrao)", 
##     data = data, subset = -31)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -1.335e-04 -6.071e-05 -3.318e-06  4.302e-05  1.744e-04 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        1.825e-03  1.210e-04  15.085  &lt; 2e-16 ***
## sqrt(area_total)  -2.441e-05  4.915e-06  -4.966 1.25e-05 ***
## rsqrt(quartos)     6.301e-04  1.174e-04   5.368 3.41e-06 ***
## identity(suites)  -3.761e-05  1.907e-05  -1.972   0.0553 .  
## sqrt(garagens)    -2.787e-04  4.090e-05  -6.814 3.02e-08 ***
## rsqrt(dist_b_mar) -2.774e-03  4.729e-04  -5.865 6.72e-07 ***
## padraomedio       -2.038e-04  4.273e-05  -4.770 2.34e-05 ***
## padraoalto        -2.529e-04  4.250e-05  -5.951 5.09e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 7.772e-05 on 41 degrees of freedom
##   (3 observations deleted due to missingness)
## Multiple R-squared:  0.9629, Adjusted R-squared:  0.9566 
## F-statistic: 152.2 on 7 and 41 DF,  p-value: &lt; 2.2e-16
## 
## NBR-14.653-2 check:
## Minimum number of market data:
## [1] "n = 53 &gt;= 42 --&gt; Grau III"
## Max significance level allowed for each predictor:
## [1] "t máximo = 5.53 %  &lt; 10% --&gt; Grau III"
## Max significance level allowed for F-test:
## [1] "p-valor F = 2.94e-25 % &lt; 1% --&gt; Grau III"</code></pre>
<p>One can note that without the outlier, the model now perfectly satisfies the main requirements of NBR 14.653-2.</p>
</div>
<div id="plots" class="section level2">
<h2 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h2>
<p>There are two plot functions in <code>appraiseR</code>: <code>plotdf</code> and <code>plotmod</code>. Before any fitting model activity, <code>plotdf</code> may be used to investigate outliers with the boxplot of the parameters of the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotdf.html">plotdf</a></span>(valor<span class="op">~</span>., data)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="plotdf-1.png" alt="plotdf output." width="90%"><p class="caption">
plotdf output.
</p>
</div>
<p>Then, once the models are fitted, <code>plotmod</code> plots regressors against the response variable, with confidence or prediction intervals:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotmod.html">plotmod</a></span>(best_fit, <span class="dt">interval =</span> <span class="st">"confidence"</span>, <span class="dt">level =</span> <span class="fl">0.80</span>)
pl</code></pre></div>
<div class="figure" style="text-align: center">
<img src="plotmod-1.png" alt="plotmod output." width="90%"><p class="caption">
plotmod output.
</p>
</div>
<p>With these plots one verifies if the variables in the model works as predicted by the user.</p>
<p>By default, <code>plotmod</code> chooses the median values of the predictors other than the one plotted. The <code>local</code> argument in <code>plotmod</code> function allows the user to specify the variables plots against the regressor which passes through that local point.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotmod.html">plotmod</a></span>(best_fit, <span class="dt">interval =</span> <span class="st">"confidence"</span>, <span class="dt">level =</span> <span class="fl">0.80</span>, 
        <span class="dt">local =</span> <span class="kw">list</span>(<span class="dt">area_total =</span> <span class="dv">205</span>, <span class="dt">quartos =</span> <span class="dv">3</span>, <span class="dt">suites =</span> <span class="dv">1</span>, <span class="dt">garagens =</span> <span class="dv">2</span>, 
                     <span class="dt">dist_b_mar =</span> <span class="dv">250</span>, <span class="dt">padrao =</span> <span class="st">"medio"</span>))</code></pre></div>
<div class="figure" style="text-align: center">
<img src="plotmod2-1.png" alt="plotmod output with local argument specified" width="90%"><p class="caption">
plotmod output with local argument specified
</p>
</div>
<p>A third visualization tool in appraiseR is the <code>gen_map</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/gen_map.html">gen_map</a></span>(centro_<span class="dv">2015</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="map-1.png" alt="gen_map output." width="90%"><p class="caption">
gen_map output.
</p>
</div>
</div>
<div id="predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#predictions" class="anchor"></a>Predictions</h2>
<p><code>predict</code> method is also available for <code>bestfit</code> objects. <code>predict</code> automatically searchs for newdata in the data frame of the model. <code>predict</code> does this searching for <code>NA</code> values in the response variable. If there are such data, then <code>predict</code> will automatically uses this values as the newdata option. Else, newdata must be explicitly provided to <code>predict.bestfit</code>, the same way it is done with <code>predict.lm</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(best_fit, <span class="dt">interval =</span> <span class="st">"confidence"</span>, <span class="dt">level =</span> <span class="fl">0.80</span>)
p</code></pre></div>
<pre><code>## Predictions:
##          fit       lwr      upr   AMP G.P.   C.A.I.    C.A.S.     L.I.
## 51  658637.5  721787.1 603426.9 17.97  III 559841.9  757433.2 603426.9
## 52  945582.0  997993.7 897193.2 10.66  III 803744.7 1087419.3 897193.2
## 53 1042721.7 1107561.0 983413.8 11.91  III 886313.4 1199129.9 983413.8
##         L.S.
## 51  721787.1
## 52  997993.7
## 53 1107561.0</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data">Data</a></li>
      <li><a href="#objective">Objective</a></li>
      <li><a href="#outlier-analysis">Outlier analysis</a></li>
      <li><a href="#running-bestfit">Running bestfit</a></li>
      <li><a href="#updating">Updating</a></li>
      <li><a href="#plots">Plots</a></li>
      <li><a href="#predictions">Predictions</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Luiz Droubi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
